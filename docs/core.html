<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>core.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>core.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">roots.graphmethods</span> <span class="kn">import</span> <span class="n">GraphMethods</span>
<span class="kn">from</span> <span class="nn">roots.kmd</span> <span class="kn">import</span> <span class="n">KMDD</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>import seaborn as sns
plt.style.use(&lsquo;seaborn-deep&rsquo;)
import matplotlib
matplotlib.rcParams.update({&lsquo;font.size&rsquo;: 32})</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="s2">&quot;clayton</span><span class="se">\&#39;</span><span class="s2">s warhorse&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>from colormap import Colormap
c = Colormap()
mycmap = c.cmap_linear(&lsquo;yellow&rsquo;,&rsquo;orange&rsquo;,&rsquo;red&rsquo;)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Analyze_roots</span><span class="p">():</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">roots</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">roots</span> <span class="o">=</span> <span class="n">roots</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">math</span> <span class="o">=</span> <span class="n">Roots_math</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">centroid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_centroid</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">xyz_dist</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">internodedist_dist</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">branchnodes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">thetas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bifurcation_thetas</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">find_branch_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">firstpoint</span><span class="p">,</span><span class="n">ownbnum</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">brnum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
			<span class="k">if</span> <span class="n">brnum</span> <span class="o">!=</span> <span class="n">ownbnum</span> <span class="ow">and</span> <span class="n">firstpoint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="p">[</span><span class="n">brnum</span><span class="p">]:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="p">[</span><span class="n">brnum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="p">[</span><span class="n">brnum</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">firstpoint</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> 
				<span class="k">except</span><span class="p">:</span>
					<span class="k">print</span><span class="p">(</span><span class="s1">&#39;parent not found&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
					<span class="k">return</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">find_branch_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">firstpoint</span><span class="p">,</span><span class="n">firstpointsecond</span><span class="p">,</span><span class="n">secondsecond</span><span class="p">):</span>	
		<span class="n">pointpresent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">firstpoint</span><span class="p">)</span>
		<span class="n">pointnext</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">firstpointsecond</span><span class="p">)</span>
		<span class="n">pointlast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">secondsecond</span><span class="p">)</span>
		<span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pointlast</span><span class="o">-</span><span class="n">pointpresent</span><span class="p">,</span><span class="n">pointnext</span><span class="o">-</span><span class="n">pointpresent</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">eucdist3d</span><span class="p">(</span><span class="n">pointpresent</span><span class="p">,</span><span class="n">pointnext</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">eucdist3d</span><span class="p">(</span><span class="n">pointpresent</span><span class="p">,</span><span class="n">pointlast</span><span class="p">)))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">find_centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
				<span class="n">x</span><span class="o">+=</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">y</span><span class="o">+=</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
				<span class="n">z</span><span class="o">+=</span><span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
		<span class="k">return</span><span class="p">([</span><span class="n">x</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">y</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">z</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">xyz_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">xdist</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ydist</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">zdist</span> <span class="o">=</span> <span class="p">[],[],[]</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">xdist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centroid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ydist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centroid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">zdist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centroid</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xdist</span><span class="p">),</span><span class="n">kde</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">rug</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;X KDE&#39;</span><span class="p">,</span> <span class="n">hist</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">kde_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shade&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ydist</span><span class="p">),</span><span class="n">kde</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">rug</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Y KDE&#39;</span><span class="p">,</span><span class="n">hist</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">kde_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shade&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zdist</span><span class="p">),</span><span class="n">kde</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">rug</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Z KDE&#39;</span><span class="p">,</span><span class="n">hist</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">kde_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shade&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;KDEs of Spatial Range of Arbor Relative to Centroid&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">bifurcation_thetas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">thetas</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">branchnodes</span><span class="p">):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">first</span><span class="p">,</span><span class="n">second</span><span class="p">,</span><span class="n">secondsecond</span> <span class="o">=</span> <span class="n">node</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">find_branch_parent</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">n</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>print(first,second,secondsecond)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>				<span class="n">thetas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_branch_angle</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">find_branch_parent</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">n</span><span class="p">)))</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">print</span><span class="p">(</span><span class="s1">&#39;theta not found&#39;</span><span class="p">)</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">thetas</span><span class="p">)),</span><span class="n">kde</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">rug</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bifurcation Angles KDE&#39;</span><span class="p">,</span> <span class="n">hist</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">kde_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shade&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Angle (Radians)&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">internodedist_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">dists</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">:]):</span>
				<span class="n">dists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">eucdist3d</span><span class="p">(</span><span class="n">point</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dists</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Internode Distance&#39;</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">rug</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">hist</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">kde_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shade&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;um&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Roots_math</span><span class="p">():</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">isKMDD</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">KMDDproperties</span><span class="o">=</span><span class="p">{},</span><span class="n">preconditionedKMDD</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">isKMDD</span> <span class="o">=</span> <span class="n">isKMDD</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">KMDDproperties</span> <span class="o">=</span> <span class="n">KMDDproperties</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isKMDD</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">cluster_reduce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMDDproperties</span><span class="p">[</span><span class="s1">&#39;cluster_reduce&#39;</span><span class="p">]</span>
				<span class="n">tri_edge_length_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMDDproperties</span><span class="p">[</span><span class="s1">&#39;tri_edge_length_max&#39;</span><span class="p">]</span>
				<span class="n">openpoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMDDproperties</span><span class="p">[</span><span class="s1">&#39;open_points&#39;</span><span class="p">]</span>
				<span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMDDproperties</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error with KMDDproperties argument dictionary. Must include KMDDproperties values for keys: &#39;cluster_reduce&#39;,&#39;tri_edge_length_max&#39;,&#39;open_points&#39;,&#39;source&#39;.&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>find spatial clusters within cloud of synaptic targets in order to simplify arbor enough to find triangulation and paths through arbor field.
find delaunay triangulation through kmeans clustered spatial network of cloud of synaptic targets</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>			<span class="bp">self</span><span class="o">.</span><span class="n">kmdd</span> <span class="o">=</span> <span class="n">KMDD</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">openpoints</span><span class="p">,</span><span class="n">cluster_reduce</span><span class="p">,</span><span class="n">tri_edge_length_max</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>Dijkstras algorithm to find shortest paths through network of pairs of points in delaunay triangulated kmeans clustered cloud of synaptic targets.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>			<span class="bp">self</span><span class="o">.</span><span class="n">source_index</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kmdd</span><span class="o">.</span><span class="n">vertices</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">nk</span> <span class="o">=</span> <span class="n">GraphMethods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kmdd</span><span class="o">.</span><span class="n">faces</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kmdd</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span><span class="n">source</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">source_index</span><span class="p">,</span><span class="n">tri_edge_length_max</span><span class="p">)</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nk</span><span class="o">.</span><span class="n">node_dict</span> <span class="o">==</span> <span class="p">{}:</span>
				<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Likely path sort failed. Try a longer tri_edge_length_max in KMDDproperties args.&#39;</span><span class="p">)</span>
			
			<span class="k">print</span><span class="p">(</span><span class="s1">&#39;got graph&#39;</span><span class="p">)</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMDDproperties</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">]</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">kmdd</span><span class="o">.</span><span class="n">plot_clusters_and_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kmdd</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span><span class="n">openpoints</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">kmdd</span><span class="o">.</span><span class="n">mayavi_plot_delaunay_tri</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">tri_edge_length_max</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">pass</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">euc_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">allpoints</span><span class="p">,</span><span class="n">point</span><span class="p">):</span>
		<span class="k">return</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">eucdist3d</span><span class="p">(</span><span class="n">thisp</span><span class="p">,</span><span class="n">point</span><span class="p">)</span> <span class="k">for</span> <span class="n">thisp</span> <span class="ow">in</span> <span class="n">allpoints</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">euc_tree_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arbor</span><span class="p">):</span>
		<span class="nb">len</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="n">arbor</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
			<span class="n">branchpoints</span> <span class="o">=</span> <span class="n">arbor</span><span class="p">[</span><span class="n">branch</span><span class="p">]</span>
			<span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">branchpoints</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="nb">len</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">eucdist3d</span><span class="p">(</span><span class="n">branchpoints</span><span class="p">[</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">branchpoints</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
				
				<span class="k">except</span><span class="p">:</span>
					<span class="k">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
		
		<span class="k">return</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">eucdist3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">point1</span><span class="p">,</span><span class="n">point2</span><span class="p">):</span>
		<span class="k">return</span><span class="p">(((</span><span class="n">point2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">point1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">point2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">point1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">point2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">point1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">angle_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allpoints</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">prevpoint</span><span class="p">):</span>
		<span class="k">return</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_angle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">thisp</span><span class="p">,</span> <span class="n">prevpoint</span><span class="p">)</span> <span class="k">for</span> <span class="n">thisp</span> <span class="ow">in</span> <span class="n">allpoints</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>chooses closest point from a set of given points and returns the index of that point in the array and the actual point itself</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">choose_nearest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">allpoints</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>		<span class="n">dists</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">euc_tree</span><span class="p">(</span><span class="n">allpoints</span><span class="p">,</span><span class="n">point</span><span class="p">),</span><span class="n">allpoints</span><span class="p">))</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">nearest</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
			<span class="n">nearestindex</span> <span class="o">=</span> <span class="n">allpoints</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nearest</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
		
		<span class="k">return</span><span class="p">(</span><span class="n">nearest</span><span class="p">,</span> <span class="n">nearestindex</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">choose_nearest_bif</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">allpoints</span><span class="p">):</span>
		<span class="n">dists</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">euc_tree</span><span class="p">(</span><span class="n">allpoints</span><span class="p">,</span><span class="n">point</span><span class="p">),</span><span class="n">allpoints</span><span class="p">))</span>
		<span class="n">nearest</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
		<span class="n">nearestindex</span> <span class="o">=</span> <span class="n">allpoints</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nearest</span><span class="p">)</span>
		<span class="k">return</span><span class="p">(</span><span class="n">nearest</span><span class="p">,</span> <span class="n">nearestindex</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>Finds branch_counter from last key and index of point on arbor and returns that key and index</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">find_point_on_arbor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arbor</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">branch_counter</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>		
		<span class="n">counter</span> <span class="o">=</span> <span class="n">branch_counter</span>
		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">arbor</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">this_point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arbor</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
				<span class="k">if</span> <span class="n">arbor</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="n">point</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
						<span class="k">return</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
					<span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">-</span> <span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>Returns a point a little over the specified path length away from the branch end</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">lookup_nearest_likely_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">point_of_int</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>		<span class="n">cluster_distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">euc_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kmdd</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span><span class="n">point_of_int</span><span class="p">)</span>
		<span class="n">sorted_distances</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">cluster_distances</span><span class="p">))</span>
		<span class="k">for</span> <span class="n">increasing_distance</span> <span class="ow">in</span> <span class="n">sorted_distances</span><span class="p">:</span>
			<span class="n">nearest_cluster_node</span> <span class="o">=</span> <span class="n">cluster_distances</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">increasing_distance</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nk</span><span class="o">.</span><span class="n">node_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="k">if</span> <span class="n">nearest_cluster_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nk</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nk</span><span class="o">.</span><span class="n">node_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]]:</span>
					<span class="n">nearest_path_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nk</span><span class="o">.</span><span class="n">node_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
					<span class="k">return</span><span class="p">(</span><span class="n">nearest_cluster_node</span><span class="p">,</span><span class="n">nearest_path_index</span><span class="p">)</span>
		
		<span class="k">print</span><span class="p">(</span><span class="s1">&#39;No path found for this cluster point&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kmdd</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">nearest_cluster_node</span><span class="p">],</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>print(&lsquo;last path considered&rsquo;,self.nk.paths[self.nk.node_dict[key]])</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>		<span class="k">try</span><span class="p">:</span>
			<span class="n">nearest_path_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nk</span><span class="o">.</span><span class="n">node_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
		<span class="k">except</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>nearest_path_index = self.nk.node_dict[list(self.nk.node_dict.keys())[0]]</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>			<span class="n">nearest_path_index</span> <span class="o">=</span> <span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>nearest_path_index = self.node_dict[nearest_cluster_node]</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>		<span class="k">return</span><span class="p">(</span><span class="n">nearest_cluster_node</span><span class="p">,</span><span class="n">nearest_path_index</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">find_diff_apply_to_other</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">):</span>
		<span class="n">diff</span> <span class="o">=</span> <span class="p">[</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">B</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
		<span class="k">return</span><span class="p">([</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">diff</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">diff</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">diff</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">find_dynamic_source_point_from_likely_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">point_of_int</span><span class="p">):</span>
		<span class="n">nearest_cluster_node</span><span class="p">,</span><span class="n">nearest_path_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup_nearest_likely_path</span><span class="p">(</span><span class="n">point_of_int</span><span class="p">)</span>
		<span class="n">nearest_node_index_in_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nk</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="n">nearest_path_index</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nearest_cluster_node</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">nearest_node_index_in_path</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nk</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="n">nearest_path_index</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
			<span class="n">nearest_node_index_in_path</span><span class="o">-=</span><span class="mi">1</span>
		<span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_diff_apply_to_other</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kmdd</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nk</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="n">nearest_path_index</span><span class="p">][</span><span class="n">nearest_node_index_in_path</span><span class="p">]],</span><span class="bp">self</span><span class="o">.</span><span class="n">kmdd</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nk</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="n">nearest_path_index</span><span class="p">][</span><span class="n">nearest_node_index_in_path</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span><span class="n">point_of_int</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">find_relative_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arbor</span><span class="p">,</span> <span class="n">point_of_int</span><span class="p">,</span> <span class="n">rel_source_dist</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isKMDD</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_dynamic_source_point_from_likely_path</span><span class="p">(</span><span class="n">point_of_int</span><span class="p">))</span>
			
			<span class="k">except</span><span class="p">:</span>
				<span class="k">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
				<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Continuing as if not KMDD directed&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
				<span class="k">return</span><span class="p">(</span><span class="n">arbor</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span><span class="p">(</span><span class="n">arbor</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>Checks whether the branch can be extended; returns true or false and the point that it should be extended with</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">branch_extension_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firstextend</span><span class="p">,</span> <span class="n">arborpoint</span><span class="p">,</span> <span class="n">prevpoint</span><span class="p">,</span> <span class="n">openpoints</span><span class="p">,</span> <span class="n">distthresh</span><span class="p">,</span> <span class="n">angthresh</span><span class="p">,</span> <span class="n">rel_source_dist</span><span class="p">,</span> <span class="n">arbor</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>		<span class="n">rel_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_relative_source</span><span class="p">(</span><span class="n">arbor</span><span class="p">,</span> <span class="n">arborpoint</span><span class="p">,</span> <span class="n">rel_source_dist</span><span class="p">)</span>
		<span class="n">refdist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eucdist3d</span><span class="p">(</span><span class="n">arborpoint</span><span class="p">,</span> <span class="n">rel_source</span><span class="p">)</span> <span class="c1">#distance from arbor point to source	</span>
		<span class="n">alldists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">euc_tree</span><span class="p">(</span><span class="n">openpoints</span><span class="p">,</span> <span class="n">rel_source</span><span class="p">)</span> <span class="c1">#array of distances from source to each open point</span>
		
		<span class="n">filteredpoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">openpoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">thisdist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">alldists</span><span class="p">)</span> <span class="k">if</span> <span class="n">thisdist</span> <span class="o">&gt;=</span> <span class="n">refdist</span><span class="p">]</span>
		<span class="n">dists</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">euc_tree</span><span class="p">(</span><span class="n">filteredpoints</span><span class="p">,</span> <span class="n">arborpoint</span><span class="p">),</span> <span class="n">filteredpoints</span><span class="p">))</span> <span class="c1">#dictionary of distances between branch tip and set of open points paired with open points</span>
		
		<span class="k">if</span> <span class="n">firstextend</span><span class="p">:</span>	
			<span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">distthresh</span><span class="p">:</span>
				<span class="k">return</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="n">dists</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span>
			
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">dists</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span>
		
		<span class="k">else</span><span class="p">:</span> <span class="c1">#finds the closest point to branch tip, to extend from</span>
			<span class="n">bad_ang</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="n">good_dist</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="n">nextpoint</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
			
			<span class="k">while</span> <span class="p">(</span><span class="n">bad_ang</span> <span class="ow">and</span> <span class="n">good_dist</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>	
				<span class="n">bad_ang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_angle</span><span class="p">(</span><span class="n">arborpoint</span><span class="p">,</span> <span class="n">dists</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span> <span class="n">prevpoint</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">angthresh</span>
				<span class="n">good_dist</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">distthresh</span>
				<span class="n">nextpoint</span> <span class="o">=</span> <span class="n">dists</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
			
			<span class="k">return</span><span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="n">bad_ang</span><span class="p">)</span> <span class="ow">and</span> <span class="n">good_dist</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nextpoint</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">return_closed_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arbor</span><span class="p">,</span><span class="n">source</span><span class="p">):</span> 
		<span class="n">closed</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">arbor</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
		<span class="n">closed</span> <span class="o">=</span> <span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">closed</span><span class="p">))</span>
		<span class="k">return</span><span class="p">(</span><span class="n">closed</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">choose_first_valid_bifurcation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arbor</span><span class="p">,</span> <span class="n">openpoint</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">angthresh</span><span class="p">,</span> <span class="n">distthresh</span><span class="p">,</span> <span class="n">rel_source_dist</span><span class="p">):</span>
		<span class="n">openpt_rel_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_relative_source</span><span class="p">(</span><span class="n">arbor</span><span class="p">,</span><span class="n">openpoint</span><span class="p">,</span><span class="n">rel_source_dist</span><span class="p">)</span>
		<span class="n">openpt_rel_source_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eucdist3d</span><span class="p">(</span><span class="n">openpoint</span><span class="p">,</span><span class="n">openpt_rel_source</span><span class="p">)</span>
		<span class="n">closed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_closed_points</span><span class="p">(</span><span class="n">arbor</span><span class="p">,</span><span class="n">source</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">c_point</span> <span class="ow">in</span> <span class="n">closed</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eucdist3d</span><span class="p">(</span><span class="n">c_point</span><span class="p">,</span><span class="n">openpt_rel_source</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">openpt_rel_source_dist</span><span class="p">:</span>
				<span class="n">filteredpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_angle</span><span class="p">(</span><span class="n">c_point</span><span class="p">,</span><span class="n">arbor</span><span class="p">,</span><span class="n">openpoint</span><span class="p">,</span><span class="n">angthresh</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">filteredpoint</span> <span class="o">==</span> <span class="p">[]:</span>
					<span class="k">continue</span>
				
				<span class="k">else</span><span class="p">:</span>
					<span class="k">print</span><span class="p">(</span><span class="n">filteredpoint</span><span class="p">)</span>
					<span class="k">return</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">filteredpoint</span><span class="p">)</span>
	
		<span class="k">return</span><span class="p">(</span><span class="bp">False</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">check_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pointpresent</span><span class="p">,</span> <span class="n">pointnext</span><span class="p">,</span> <span class="n">pointlast</span><span class="p">):</span>
		<span class="n">pointpresent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pointpresent</span><span class="p">)</span>
		<span class="n">pointnext</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pointnext</span><span class="p">)</span>
		<span class="n">pointlast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pointlast</span><span class="p">)</span>
		<span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pointlast</span><span class="o">-</span><span class="n">pointpresent</span><span class="p">,</span><span class="n">pointnext</span><span class="o">-</span><span class="n">pointpresent</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eucdist3d</span><span class="p">(</span><span class="n">pointpresent</span><span class="p">,</span><span class="n">pointnext</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eucdist3d</span><span class="p">(</span><span class="n">pointpresent</span><span class="p">,</span><span class="n">pointlast</span><span class="p">)))))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">filter_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filteredpoints</span><span class="p">,</span> <span class="n">arbor</span><span class="p">,</span> <span class="n">openpoint</span><span class="p">,</span> <span class="n">angthresh</span><span class="p">):</span>
		<span class="n">morefilteredpoints</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#array for output of function</span>
		<span class="k">for</span> <span class="n">fpoint</span> <span class="ow">in</span> <span class="n">filteredpoints</span><span class="p">:</span> <span class="c1">#goes through each point in array, checks whether it is below angle threshold, and if so, appends point to morefilteredpoints</span>
			<span class="n">goodangle</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">arbor</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="k">if</span> <span class="n">fpoint</span> <span class="ow">in</span> <span class="n">arbor</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
					<span class="n">pointfoundindex</span> <span class="o">=</span> <span class="n">arbor</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">fpoint</span><span class="p">)</span> <span class="c1">#finds index of the point on the arbor in that key</span>
					<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_angle</span><span class="p">(</span><span class="n">fpoint</span><span class="p">,</span> <span class="n">arbor</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">pointfoundindex</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">openpoint</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">angthresh</span><span class="p">:</span> <span class="c1">#checks whether angle meets threshold</span>
						<span class="n">goodangle</span> <span class="o">=</span> <span class="bp">False</span>
						<span class="k">break</span>
			
			<span class="k">if</span> <span class="n">goodangle</span><span class="p">:</span>
				<span class="n">morefilteredpoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpoint</span><span class="p">)</span>
		
		<span class="k">return</span><span class="p">(</span><span class="n">morefilteredpoints</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">filter_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filteredpoint</span><span class="p">,</span> <span class="n">arbor</span><span class="p">,</span> <span class="n">openpoint</span><span class="p">,</span> <span class="n">angthresh</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">arbor</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
			<span class="k">if</span> <span class="n">filteredpoint</span> <span class="ow">in</span> <span class="n">arbor</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
				<span class="n">pointfoundindex</span> <span class="o">=</span> <span class="n">arbor</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">filteredpoint</span><span class="p">)</span> <span class="c1">#finds index of the point on the arbor in that key</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_angle</span><span class="p">(</span><span class="n">arbor</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">pointfoundindex</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">filteredpoint</span><span class="p">,</span> <span class="n">openpoint</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">angthresh</span><span class="p">:</span> <span class="c1">#checks whether angle meets threshold</span>
					<span class="k">return</span><span class="p">([])</span>
				
				<span class="k">else</span><span class="p">:</span>
					<span class="k">return</span><span class="p">(</span><span class="n">filteredpoint</span><span class="p">)</span>
		
		<span class="k">return</span><span class="p">([])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <pre><code>source - point from which the tree begins (not a member of open 'points' which is a separate argument)
points - open points through which the tree must grow (does not include 'source')
s_ang - branch extension angle threshold
s_dist - branch extension distance threshold
b_ang - bifurcation angle threshold
b_dist - bifurcation distance threshold
rel_source_dist - (disabled for KMDD mode growing) minimum distance down the active branch on which to find a bifurcation point
KMDDproperties - properties of k-means, delaunay triangulation for 'likely path' sorting for dynamic source updating fibers provided as a dictionary
    KMDDproperties:
            cluster_reduce - proportion of reduction for k-means clustering (i.e. if cluster_reduce == 0.25 then the number of clusters will equal 25% of the number of open points)
            tri_edge_length_max - the meshing distance threshold below which delaunay triangulated edges will be returned (i.e. triangulated edges longer than tri_edge_length_max will be removed from the triangulation)
            openpoints - open points to be clustered and meshed (same as ROOTS argument 'points')
            source - source point from which a tree will be grown (same as ROOTS argument 'source')
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Roots</span><span class="p">():</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span><span class="n">total_length</span><span class="p">,</span> <span class="n">s_ang</span><span class="p">,</span> <span class="n">s_dist</span><span class="p">,</span> <span class="n">b_ang</span><span class="p">,</span> <span class="n">b_dist</span><span class="p">,</span> <span class="n">bnum_limit</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="n">rel_source_dist</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">KMDDproperties</span><span class="o">=</span><span class="p">{}):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">KMDDproperties</span> <span class="o">=</span> <span class="n">KMDDproperties</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">openpoints</span> <span class="o">=</span> <span class="n">points</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">tot_len_threshold</span> <span class="o">=</span> <span class="n">total_length</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bnum_limit</span> <span class="o">=</span> <span class="n">bnum_limit</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">s_ang</span> <span class="o">=</span> <span class="n">s_ang</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">s_dist</span> <span class="o">=</span> <span class="n">s_dist</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">b_ang</span> <span class="o">=</span> <span class="n">b_ang</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">b_dist</span> <span class="o">=</span> <span class="n">b_dist</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">rel_source_dist</span> <span class="o">=</span> <span class="n">rel_source_dist</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">allpoints</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">openpoints</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">arbor</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:[</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">]}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">stamps</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMDDproperties</span> <span class="o">==</span> <span class="p">{}:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">math</span> <span class="o">=</span> <span class="n">Roots_math</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">KMDDproperties</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">sort_points</span><span class="p">()</span>
		
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">math</span> <span class="o">=</span> <span class="n">Roots_math</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">KMDDproperties</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">sort_points</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <p>self.plotroots = Roots_plot()</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">stamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">stamps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">sort_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">stamp</span><span class="p">(</span><span class="s1">&#39;sort points&#39;</span><span class="p">)</span>
		<span class="n">tpoints</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">openpoints</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">euc_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">openpoints</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)))</span>
		<span class="n">tpoints</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">openpoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">tpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">tpoint</span> <span class="ow">in</span> <span class="n">tpoints</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">stamp</span><span class="p">(</span><span class="s1">&#39;sort points&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">clean_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">point</span><span class="p">):</span>
		<span class="n">pointindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openpoints</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">openpoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openpoints</span><span class="p">[:</span><span class="n">pointindex</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">openpoints</span><span class="p">[</span><span class="n">pointindex</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">bifurcate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">branchpoint</span><span class="p">,</span> <span class="n">newpoint</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">arbor</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arbor</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span> <span class="o">=</span> <span class="p">[</span><span class="n">branchpoint</span><span class="p">,</span> <span class="n">newpoint</span><span class="p">]</span> <span class="c1">#appends new key at end of arbor as a new branch. This is an array of two points, the point previously on the arbor and a new point branching off from this point</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">is_acceptable_total_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_total_arbor_length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tot_len_threshold</span><span class="p">:</span>
			<span class="k">return</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
		
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">is_acceptable_number_of_branches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arbor</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bnum_limit</span><span class="p">:</span>
			<span class="k">return</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
		
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">calculate_total_arbor_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">euc_tree_length</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arbor</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">add_to_arbor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">newpoint</span><span class="p">):</span>
		<span class="n">arborindex</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arbor</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">arbor</span><span class="p">[</span><span class="n">arborindex</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newpoint</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">prims</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">arborindex</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arbor</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="c1">#last key in arbor</span>
		<span class="n">number_of_points</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">stillextending</span> <span class="o">=</span> <span class="bp">True</span>
		
		<span class="k">while</span> <span class="n">stillextending</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arbor</span><span class="p">[</span><span class="n">arborindex</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1">#initial branch extension from soma</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      <p>goodextend, nearest = self.math.branch_extension_check(True, self.arbor[arborindex][-1], self.arbor[arborindex][-1], self.openpoints, self.s_dist, self.s_ang, self.source)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>				<span class="n">goodextend</span><span class="p">,</span> <span class="n">nearest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">branch_extension_check</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arbor</span><span class="p">[</span><span class="n">arborindex</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">arbor</span><span class="p">[</span><span class="n">arborindex</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">openpoints</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_dist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_ang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_source_dist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arbor</span><span class="p">)</span>
			
			<span class="k">else</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      <p>goodextend, nearest = self.math.branch_extension_check(False, self.arbor[arborindex][-1], self.arbor[arborindex][-2], self.openpoints, self.s_dist, self.s_ang, self.source)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>				<span class="n">goodextend</span><span class="p">,</span> <span class="n">nearest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">branch_extension_check</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arbor</span><span class="p">[</span><span class="n">arborindex</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">arbor</span><span class="p">[</span><span class="n">arborindex</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">openpoints</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_dist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_ang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_source_dist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arbor</span><span class="p">)</span>
			
			<span class="k">if</span> <span class="n">goodextend</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">add_to_arbor</span><span class="p">(</span><span class="n">nearest</span><span class="p">)</span> <span class="c1">#adds point to end of last key of the arbor</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">clean_points</span><span class="p">(</span><span class="n">nearest</span><span class="p">)</span> <span class="c1">#gets rid of added point from the set of open points</span>
				<span class="n">number_of_points</span> <span class="o">=</span> <span class="n">number_of_points</span> <span class="o">+</span> <span class="mi">1</span>
				<span class="n">stillextending</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_acceptable_total_length</span><span class="p">()</span>
				<span class="k">continue</span>
			
			<span class="n">stillextending</span> <span class="o">=</span> <span class="bp">False</span>
		
		<span class="k">return</span><span class="p">(</span><span class="n">number_of_points</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-54'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-54'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">find_branch_point</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">goodbranch</span> <span class="o">=</span> <span class="bp">False</span>
		<span class="k">for</span> <span class="n">newpoint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">openpoints</span><span class="p">:</span> <span class="c1">#goes through each open point</span>
			<span class="n">goodbranch</span><span class="p">,</span> <span class="n">nearest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">choose_first_valid_bifurcation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arbor</span><span class="p">,</span> <span class="n">newpoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_ang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_dist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_source_dist</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-55'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-55'>#</a>
      </div>
      <p>print(goodbranch,nearest)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>			<span class="k">if</span> <span class="n">goodbranch</span><span class="p">:</span>	
				<span class="bp">self</span><span class="o">.</span><span class="n">bifurcate</span><span class="p">(</span><span class="n">nearest</span><span class="p">,</span> <span class="n">newpoint</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">clean_points</span><span class="p">(</span><span class="n">newpoint</span><span class="p">)</span>
				<span class="n">goodbranch</span> <span class="o">=</span> <span class="bp">True</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-56'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-56'>#</a>
      </div>
      <p>print(&lsquo;bifurcated&rsquo;)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>				<span class="k">break</span>
		
		<span class="k">return</span><span class="p">(</span><span class="n">goodbranch</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-57'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-57'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">goodbranch</span> <span class="o">=</span> <span class="bp">True</span>
		<span class="n">number_of_points</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">stamp</span><span class="p">(</span><span class="s1">&#39;grow&#39;</span><span class="p">)</span>
		<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">openpoints</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">goodbranch</span><span class="p">:</span> <span class="c1">#grows arbor using prims and find_branch_point methods, till there are no more open points or goodbranch is false</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">stamp</span><span class="p">(</span><span class="s1">&#39;prims&#39;</span><span class="p">)</span>
			<span class="n">number_of_points</span> <span class="o">=</span> <span class="n">number_of_points</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prims</span><span class="p">()</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_acceptable_total_length</span><span class="p">():</span>
				<span class="k">return</span><span class="p">(</span><span class="n">number_of_points</span><span class="p">)</span>
			
			<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_acceptable_number_of_branches</span><span class="p">():</span>
				<span class="k">return</span><span class="p">(</span><span class="n">number_of_points</span><span class="p">)</span>
			
			<span class="bp">self</span><span class="o">.</span><span class="n">stamp</span><span class="p">(</span><span class="s1">&#39;prims&#39;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">stamp</span><span class="p">(</span><span class="s1">&#39;bifurcate&#39;</span><span class="p">)</span>
			<span class="n">goodbranch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_branch_point</span><span class="p">()</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">stamp</span><span class="p">(</span><span class="s1">&#39;bifurcate&#39;</span><span class="p">)</span>
			<span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">100.0</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">number_of_points</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allpoints</span><span class="p">)),</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;%&#39;</span><span class="o">+</span><span class="s1">&#39; connected&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">stamp</span><span class="p">(</span><span class="s1">&#39;grow&#39;</span><span class="p">)</span>
		<span class="k">return</span><span class="p">(</span><span class="n">number_of_points</span><span class="p">)</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
